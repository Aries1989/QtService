<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QtService: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="display: inline;">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QtService
   &#160;<span id="projectnumber">1.1.0</span>
   </div>
   <div id="projectbrief">A platform independent library to easily create system services and use some of their features</div>
  </td>
 </tr>
 </tbody>
</table>
<a style="float: right;" target="_blank"  href="https://github.com/Skycoder42/QtService">
<img style="padding: 10px;" src="GitHub_Logo.png"/>
</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">QtService Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#qtservice_readme_label_0">Features</a></li>
<li class="level1"><a href="#qtservice_readme_label_1">Download/Installation</a></li>
<li class="level1"><a href="#qtservice_readme_label_2">Usage</a><ul><li class="level2"><a href="#qtservice_readme_label_3">Terminals</a></li>
<li class="level2"><a href="#qtservice_readme_label_4">Service Control</a></li>
</ul>
</li>
<li class="level1"><a href="#qtservice_readme_label_5">Documentation</a></li>
<li class="level1"><a href="#qtservice_readme_label_6">References</a></li>
</ul>
</div>
<div class="textblock"><p>A platform independent library to easily create system services and use some of their features</p>
<p><a href="https://travis-ci.org/Skycoder42/QtService"></a> <a href="https://ci.appveyor.com/project/Skycoder42/qtservice"></a> <a href="https://www.codacy.com/app/Skycoder42/QtService"></a> <a href="https://aur.archlinux.org/packages/qt5-service/"></a></p>
<h1><a class="anchor" id="qtservice_readme_label_0"></a>
Features</h1>
<ul>
<li>Allows you to create system (and user) services for various systems<ul>
<li>Provides a single Interface to implement only once without having to care to much about the platform</li>
<li>Actual platform specifc stuff is provided via plugins, making it easy to support other backends as well</li>
<li>Most backends support native logging (i.e. journald, syslog, winevents, ...)</li>
<li>Supports socket-activation (for systemd &amp; launchd)</li>
<li>Interfaces can be used to handle general service events</li>
</ul>
</li>
<li>Easy testing/debugging by simply switching the service backend via the start arguments</li>
<li>Provides very basic service control to, e.g. get the status of a service or start/stop it</li>
<li>Provides generic callbacks to allow realtively easy access to platform specific features</li>
<li>Comes with a "Terminal frontend mode" which allows to create a CLI interface that communicates with the actual service without any extra coding needed<ul>
<li>Terminals will connect to the running service. If none is running, they can start it (on some platforms)</li>
<li>Terminals send their command line arguments to the running service</li>
<li>A connected terminal can send input to the master (via stdin) and receive output (stdout)</li>
<li>Terminals can disconnect by beeing closed, leaving the service running (even the one that started the master)</li>
<li>The Service gets a "Terminal" handle for each connected terminal, allowing parallel connections. Each terminal implements <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qiodevice.html">QIODevice</a>, making communication easy</li>
<li>For all this no extra code is needed from your side</li>
</ul>
</li>
<li>Supported service backends:<ul>
<li>Systemd (For most modern Linux Distros)</li>
<li>Windows Services</li>
<li>Launchd (Tested on MacOs, but should theoretically work on other unixes as well)</li>
<li>Android Services</li>
<li>"Standard Services" - A platform independed dummy backend that runs services as a normal proccess - useful for testing, debugging or as fallback.</li>
</ul>
</li>
<li>QtCreator template to easily create a service project, with configuration file templates for each platform</li>
</ul>
<p><b>Note:</b> What this framework does explicitly <em>not</em> handle is "service installation" - as that is extremly different on all platforms and cannot be easily generalized. Performing the service installation, registration or whatever the platform needs is up to the developer. However, all the files that are needed as metadata for a service on each platform are provided via the QtCreator project template, which makes it significantly easier to deploy your service, as all thats left is to correctly "apply" those.</p>
<p>Details on what exactly is supported by each backend can be found in the doxygen documentation under the "Related Pages" tab.</p>
<h1><a class="anchor" id="qtservice_readme_label_1"></a>
Download/Installation</h1>
<ol type="1">
<li><a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtqml/qtqml.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qml-package.html">Package</a> Managers: The library is available via:<ul>
<li><b>Arch-Linux:</b> AUR-Repository: <a href="https://aur.archlinux.org/packages/qt5-service/"><code>qt5-service</code></a></li>
<li><b>Ubuntu:</b> Launchpad-PPA: <a href="https://launchpad.net/~skycoder42/+archive/ubuntu/qt-modules">ppa:skycoder42/qt-modules</a>, package <code>libqt5service[1/-dev]</code></li>
<li><b>MacOs:</b><ul>
<li>Tap: <a href="https://github.com/Skycoder42/homebrew-qt-modules"><code>brew tap Skycoder42/qt-modules</code></a></li>
<li><a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtqml/qtqml.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qml-package.html">Package</a>: <code>qtservice</code></li>
<li><b>IMPORTANT:</b> Due to limitations of homebrew, you must run <code>source /usr/local/opt/qtservice/bashrc.sh</code> before you can use the module.</li>
</ul>
</li>
</ul>
</li>
<li>Simply add my repository to your <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qt.html">Qt</a> MaintenanceTool (Image-based How-To here: <a href="https://github.com/Skycoder42/QtModules/blob/master/README.md#add-my-repositories-to-qt-maintenancetool">Add custom repository</a>):<ol type="a">
<li>Start the MaintenanceTool from the commandline using <code>/path/to/MaintenanceTool --addTempRepository &lt;url&gt;</code> with one of the following urls (GUI-Method is currently broken, see <a href="https://bugreports.qt.io/browse/QTIFW-1156">QTIFW-1156</a>) - This must be done <em>every time</em> you start the tool:<ul>
<li>On Linux: <a href="https://install.skycoder42.de/qtmodules/linux_x64">https://install.skycoder42.de/qtmodules/linux_x64</a></li>
<li>On Windows: <a href="https://install.skycoder42.de/qtmodules/windows_x86">https://install.skycoder42.de/qtmodules/windows_x86</a></li>
<li>On Mac: <a href="https://install.skycoder42.de/qtmodules/mac_x64">https://install.skycoder42.de/qtmodules/mac_x64</a></li>
</ul>
</li>
<li>A new entry appears under all supported <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qt.html">Qt</a> Versions (e.g. <code><a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qt.html">Qt</a> &gt; <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qt.html">Qt</a> 5.11 &gt; Skycoder42 <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qt.html">Qt</a> modules</code>)</li>
<li>You can install either all of my modules, or select the one you need: <code><a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qt.html">Qt</a> Service</code></li>
<li>Continue the setup and thats it! you can now use the module for all of your installed Kits for that <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qt.html">Qt</a> Version</li>
</ol>
</li>
<li>Download the compiled modules from the release page. <b>Note:</b> You will have to add the correct ones yourself and may need to adjust some paths to fit your installation! In addition to that, you will have to download the modules this one depends on as well.</li>
<li>Build it yourself! <b>Note:</b> This requires all build an runtime dependencies to be available. If you don't have/need cmake, you can ignore the related warnings. To automatically build and install to your <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qt.html">Qt</a> installation, run:<ul>
<li><code>qmake</code></li>
<li><code>make qmake_all</code></li>
<li><code>make</code> (If you want the tests/examples/etc. run <code>make all</code>)</li>
<li>Optional steps:<ul>
<li><code>make doxygen</code> to generate the documentation</li>
<li><code>make lrelease</code> to generate the translations</li>
</ul>
</li>
<li><code>make install</code></li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="qtservice_readme_label_2"></a>
Usage</h1>
<p>The C++ part of the Service is relatively simple. All you have to do is implement the <code><a class="el" href="class_qt_service_1_1_service.html" title="The main interface to implement to create a service. ">QtService::Service</a></code> interface and start it in your main. The most important methods of the service are <code>start</code> and <code>stop</code> - which are called when the service was started or stopped...</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>TestService : <span class="keyword">public</span> <a class="code" href="class_qt_service_1_1_service.html">QtService::Service</a></div><div class="line">{</div><div class="line">    Q_OBJECT</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">explicit</span> TestService(<span class="keywordtype">int</span> &amp;argc, <span class="keywordtype">char</span> **argv) : <span class="comment">//the reference here is important!</span></div><div class="line">        Service{argc, argv}</div><div class="line">    {}</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    CommandMode <a class="code" href="class_qt_service_1_1_service.html#a511ad3160fbdf5791db906072ffc091a">onStart</a>()<span class="keyword"> override </span>{</div><div class="line">        qDebug() &lt;&lt; <span class="stringliteral">&quot;Service was started&quot;</span>;</div><div class="line">        <span class="keywordflow">return</span> Synchronous; <span class="comment">//service is now assumed started</span></div><div class="line">    }</div><div class="line"></div><div class="line">    CommandMode <a class="code" href="class_qt_service_1_1_service.html#a144aa7e5018a37d30f86be9757663fa7">onStop</a>(<span class="keywordtype">int</span> &amp;exitCode)<span class="keyword"> override </span>{</div><div class="line">        qDebug() &lt;&lt; <span class="stringliteral">&quot;Stop received&quot;</span>;</div><div class="line">        <span class="comment">// do some complicated stopping stuff asynchronously that takes some time...</span></div><div class="line">        <a class="codeRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qtimer.html#singleShot-prop">QTimer::singleShot</a>(3000, <span class="keyword">this</span>, [<span class="keyword">this</span>](){</div><div class="line">            emit <a class="code" href="class_qt_service_1_1_service.html#a1d967420b3b868cce39f814c22f275e5">stopped</a>(EXIT_SUCCESS);</div><div class="line">        });</div><div class="line">        <span class="keywordflow">return</span> Asynchronous; <span class="comment">// service is still stopping until &quot;stopped&quot; has been emitted</span></div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div><div class="line">    <span class="comment">// IMPORTANT: do NOT create a QCoreApplication here - this is done internally by the backends!</span></div><div class="line">    <span class="comment">// also, do nothing else in the main besides setting the serices properties! Any setup etc. must all be</span></div><div class="line">    <span class="comment">// done in the onStart method!!!</span></div><div class="line">    TestService service{argc, argv};</div><div class="line">    <span class="keywordflow">return</span> service.exec();</div><div class="line">}</div></div><!-- fragment --><p><b>Rules of usage:</b><br />
 You should always follow the following rules when using/creating a service. You can also find this list in the <a class="el" href="class_qt_service_1_1_service.html" title="The main interface to implement to create a service. ">QtService::Service</a> class documentation:</p>
<ul>
<li>Do not create a <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qcoreapplication.html">QCoreApplication</a> yourself - this is done internally</li>
<li>Use the same constructor signature to pass the main arguments. It is very important that the argc argument is passed as reference! Passing as value will crash your application</li>
<li>Do nothing else in the main besides setting the serices properties that need to be set early! Any setup etc. must all be done in the Service::onStart method!!! (The properties that need to be set early all have a hint in their documentation)</li>
<li>Never call <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qcoreapplication.html#quit">QCoreApplication::quit</a> (or <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qcoreapplication.html#exit">QCoreApplication::exit</a>)! Use Service::quit instead</li>
<li>Do not rely on <a class="elRef" target="_blank" doxygen="/home/sky/Qt/Docs/Qt-5.11.2/qtcore/qtcore.tags:https://doc.qt.io/qt-5/" href="https://doc.qt.io/qt-5/qcoreapplication.html#aboutToQuit">QCoreApplication::aboutToQuit</a>, as this may not be emitted at all, or on some arbitrary point. Put all cleanup code in the Service::onStop method</li>
<li>Be careful with Service::preStart - only use it when you have no other choice</li>
</ul>
<p>Actually running the service depends on your choosen backend. When testing with the standard backend, you can simply run the service without any parameters, or the backend explicitly specified:</p>
<div class="fragment"><div class="line">/path/to/service --backend standard</div></div><!-- fragment --><p>To run with a system backend, you need to register the executable somehow in the service system of your operating system. The trick here is to register it with the backend as parameter. So for example, on windows you would register the service as <code>\path\to\service --backend windows</code>. For more details check the documentation or create a service project from the template - it will create service files that already do this for you.</p>
<h2><a class="anchor" id="qtservice_readme_label_3"></a>
Terminals</h2>
<p>To allow terminals, you must set the <code><a class="el" href="class_qt_service_1_1_service.html#a57801cc8e80075002fc7eb4ab12f2ecb" title="Specifies whether the service accepts terminals. ">QtService::Service::terminalActive</a></code> property to <code>true</code> and implement the <code><a class="el" href="class_qt_service_1_1_service.html#a3a55dd15310403b3351e9f6b737326d4" title="Is called by the backend for every newly connected terminal. ">QtService::Service::terminalConnected</a></code> and optionally the <code><a class="el" href="class_qt_service_1_1_service.html#a6d0e43426aa84216e085615dd3d1767e" title="Is called from the terminal process to perform early CLI validation. ">QtService::Service::verifyCommand</a></code> methods. The service is started the same way as usual. Internally, you will get the terminals as soon as they have connected and can then process their arguments and communicate with them.</p>
<p>To start a terminal client, simply prepend <code>--terminal</code> as well as the backend the service is running on to the command line. It is recommended to create a small wrapper script for each platform that takes care of these parameters. On linux, for example, you would create a shell script like below that simply starts the executable with the additional parameters:</p>
<div class="fragment"><div class="line">#!/bin/sh</div><div class="line"># use as &quot;service-cli &lt;arguments&gt;&quot; (assuming this script is named service-cli)</div><div class="line">exec /path/to/service -platform minimal --backend systemd --terminal &quot;$@&quot;</div></div><!-- fragment --><p>(The platform argument is recommended to not depend on any windowing system)</p>
<h2><a class="anchor" id="qtservice_readme_label_4"></a>
Service Control</h2>
<p>The <code><a class="el" href="class_qt_service_1_1_service_control.html" title="A class to interact with the systems service manager. ">QtService::ServiceControl</a></code> allows you to control services by sending commands to them and retrieving the status. However, what exactly is possible greatly varies for each platform. Always use <code><a class="el" href="class_qt_service_1_1_service_control.html#a58837e8f71b8cf90fd6d1d335f326326" title="The features that this implementation supports. ">QtService::ServiceControl::supportFlags</a></code> to figure out what you can actually do on the current platform. You can also check the doxygen documentation to get an overview over all the backends and their features.</p>
<h1><a class="anchor" id="qtservice_readme_label_5"></a>
Documentation</h1>
<p>The documentation is available on <a href="https://skycoder42.github.io/QtService/">github pages</a>. It was created using <a href="http://www.doxygen.org/">doxygen</a>. The HTML-documentation and Qt-Help files are shipped together with the module for both the custom repository and the package on the release page. Please note that doxygen docs do not perfectly integrate with QtCreator/QtAssistant.</p>
<h1><a class="anchor" id="qtservice_readme_label_6"></a>
References</h1>
<p>The Service backend code for the windows plugin was created by using the code from <a href="https://github.com/qtproject/qt-solutions">https://github.com/qtproject/qt-solutions</a> as a basis. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Oct 31 2018 12:09:16 for QtService by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
